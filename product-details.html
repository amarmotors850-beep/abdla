<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تفاصيل المنتج | عبدالله للسيارات</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    <style>
        :root {
            --primary: #c53030;
            --primary-dark: #9b2c2c;
            --secondary: #0a0a0a;
            --light: #f7fafc;
            --gray: #a0aec0;
            --dark-gray: #4a5568;
            --white: #ffffff;
            --success: #38a169;
            --warning: #ed8936;
            --danger: #e53e3e;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif !important;
            background-color: var(--white);
            color: var(--secondary);
            overflow-x: hidden;
            text-align: right;
        }

        /* Loading Screen */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #loadingVideo {
            width: 200px;
            height: 200px;
            object-fit: contain;
            margin-bottom: 2rem;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 3px solid rgba(255, 255, 255, 0.3);
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }

        .loading-bar-container {
            width: 300px;
            height: 6px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .loading-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            animation: loadingAnimation 2s ease-in-out forwards;
        }

        @keyframes loadingAnimation {
            0% { width: 0%; }
            50% { width: 60%; }
            100% { width: 100%; }
        }

        /* Navigation */
        .product-nav {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 1.5rem 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--primary);
        }

        .back-button {
            color: var(--primary);
            text-decoration: none;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
            padding: 0.5rem 1rem;
            border-radius: 5px;
            font-family: 'Cairo', sans-serif !important;
            font-weight: 600;
        }

        .back-button:hover {
            background: rgba(197, 48, 48, 0.1);
        }

        .nav-logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            text-decoration: none;
        }

        .nav-logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid var(--primary);
            box-shadow: 0 0 20px rgba(197, 48, 48, 0.2);
            animation: pulseLogo 2s infinite;
        }

        @keyframes pulseLogo {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(197, 48, 48, 0.3);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 40px rgba(197, 48, 48, 0.5);
                transform: scale(1.05);
            }
        }

        .nav-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .logo-text {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--secondary);
            font-family: 'Cairo', sans-serif !important;
        }

        .logo-text span {
            color: var(--primary);
        }

        /* Product Container */
        .product-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 8rem 2rem 4rem;
        }

        @media (max-width: 768px) {
            .product-container {
                padding: 6rem 1rem 2rem;
            }
        }

        /* Product Header */
        .product-header {
            margin-bottom: 3rem;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--dark-gray);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .breadcrumb a {
            color: var(--dark-gray);
            text-decoration: none;
            transition: var(--transition);
        }

        .breadcrumb a:hover {
            color: var(--primary);
        }

        /* Product Content */
        .product-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            margin-bottom: 4rem;
        }

        @media (max-width: 992px) {
            .product-content {
                grid-template-columns: 1fr;
            }
        }

        /* Product Gallery */
        .product-gallery {
            position: relative;
        }

        .main-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: 15px;
            margin-bottom: 1rem;
            border: 2px solid var(--primary);
            box-shadow: 0 10px 30px rgba(197, 48, 48, 0.1);
        }

        .thumbnail-slider {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding: 1rem 0;
        }

        .thumbnail {
            width: 100px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .thumbnail:hover,
        .thumbnail.active {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        /* Product Info */
        .product-info {
            padding: 2rem;
            background: var(--light);
            border-radius: 15px;
            border: 2px solid var(--primary);
        }

        .product-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 1rem;
        }

        .product-category {
            display: inline-block;
            background: rgba(197, 48, 48, 0.1);
            color: var(--primary);
            padding: 0.3rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        .product-price-section {
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid var(--primary);
        }

        .current-price {
            font-size: 2.5rem;
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .old-price {
            font-size: 1.5rem;
            color: var(--gray);
            text-decoration: line-through;
            margin-right: 1rem;
        }

        .discount {
            background: var(--primary);
            color: white;
            padding: 0.3rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Installment Section */
        .installment-section {
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }

        .installment-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .installment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .installment-option {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            border: 2px solid transparent;
        }

        .installment-option:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: white;
        }

        .installment-option.selected {
            background: rgba(255, 255, 255, 0.3);
            border-color: white;
        }

        .installment-months {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .installment-down {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .installment-monthly {
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        /* Product Actions */
        .product-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            .product-actions {
                flex-direction: column;
            }
        }

        .buy-button {
            flex: 1;
            padding: 1.2rem;
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .buy-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(197, 48, 48, 0.3);
        }

        .contact-button {
            padding: 1.2rem 2rem;
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .contact-button:hover {
            background: rgba(197, 48, 48, 0.1);
        }

        /* Product Details Tabs */
        .product-tabs {
            margin-top: 4rem;
        }

        .tabs-header {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
            margin-bottom: 2rem;
        }

        .tab-button {
            padding: 1rem 2rem;
            background: none;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-gray);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .tab-button.active {
            color: var(--primary);
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: 0;
            width: 100%;
            height: 2px;
            background: var(--primary);
        }

        .tab-content {
            display: none;
            padding: 2rem;
            background: var(--light);
            border-radius: 15px;
            border: 2px solid var(--primary);
        }

        .tab-content.active {
            display: block;
        }

        /* Specifications Grid */
        .specs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .spec-label {
            font-weight: 600;
            color: var(--dark-gray);
        }

        .spec-value {
            color: var(--secondary);
            font-weight: 500;
        }

        /* Features Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .feature-icon {
            color: var(--primary);
            font-size: 1.2rem;
        }

        /* Related Products */
        .related-products {
            margin-top: 4rem;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--secondary);
            margin-bottom: 2rem;
            text-align: center;
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 2rem;
        }

        .related-card {
            background: var(--light);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid #e2e8f0;
            transition: var(--transition);
        }

        .related-card:hover {
            transform: translateY(-10px);
            border-color: var(--primary);
            box-shadow: 0 15px 30px rgba(197, 48, 48, 0.1);
        }

        .related-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .related-info {
            padding: 1.5rem;
        }

        .related-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--secondary);
        }

        .related-price {
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .related-button {
            display: block;
            width: 100%;
            padding: 0.8rem;
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            text-align: center;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: var(--transition);
        }

        .related-button:hover {
            background: var(--primary);
            color: white;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 1rem 2rem;
            background: var(--primary);
            color: white;
            border-radius: 10px;
            z-index: 10000;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.3s ease;
            display: none;
        }

        .toast.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .product-nav {
                padding: 1rem;
                flex-wrap: wrap;
                gap: 1rem;
            }
            
            .product-title {
                font-size: 2rem;
            }
            
            .current-price {
                font-size: 2rem;
            }
            
            .tabs-header {
                flex-direction: column;
            }
            
            .tab-button {
                width: 100%;
                text-align: center;
            }
            
            .related-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <video id="loadingVideo" autoplay muted playsinline>
            <source src="logo.mp4" type="video/mp4">
        </video>
        <div class="loading-bar-container">
            <div class="loading-bar"></div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="product-nav">
        <a href="index.html" class="back-button">
            <i class="fas fa-arrow-right"></i>
            <span>العودة للرئيسية</span>
        </a>
        <a href="index.html" class="nav-logo-container">
            <div class="nav-logo">
                <img src="logo.png" alt="عبدالله للسيارات" onerror="this.src='https://via.placeholder.com/50'">
            </div>
            <div class="logo-text">عبدالله <span>للسيارات</span></div>
        </a>
    </nav>

    <!-- Product Container -->
    <div class="product-container">
        <!-- Breadcrumb -->
        <div class="product-header">
            <div class="breadcrumb">
                <a href="index.html">الرئيسية</a>
                <span>/</span>
                <a href="index.html#products">السيارات</a>
                <span>/</span>
                <span id="productBreadcrumb">تفاصيل المنتج</span>
            </div>
        </div>

        <!-- Product Content -->
        <div id="productContent">
            <div style="text-align: center; padding: 4rem;">
                <i class="fas fa-spinner fa-spin" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                <p>جاري تحميل تفاصيل المنتج...</p>
            </div>
        </div>

        <!-- Related Products -->
        <div class="related-products" id="relatedProductsSection" style="display: none;">
            <h2 class="section-title">سيارات مشابهة</h2>
            <div class="related-grid" id="relatedProductsGrid">
                <!-- سيتم تحميل السيارات المشابهة ديناميكياً -->
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="sync.js"></script>
    <script>
        let siteData = null;
        let currentProduct = null;
        let selectedInstallment = null;

        // التهيئة
        document.addEventListener('DOMContentLoaded', async () => {
            startLoadingAnimation();
            await loadSiteData();
            await loadProductDetails();
        });

        // رسوميات التحميل
        function startLoadingAnimation() {
            const loadingScreen = document.getElementById('loadingScreen');
            const loadingVideo = document.getElementById('loadingVideo');

            const onLoadingComplete = () => {
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }, 500);
            };

            loadingVideo.addEventListener('ended', onLoadingComplete);
            setTimeout(onLoadingComplete, 2000);
        }

        // تحميل بيانات الموقع
        async function loadSiteData() {
            try {
                if (window.gitHubSync && window.gitHubSync.fetch) {
                    siteData = await window.gitHubSync.fetch();
                } else {
                    const savedData = localStorage.getItem('siteData');
                    siteData = savedData ? JSON.parse(savedData) : { products: [], categories: [] };
                }
            } catch (error) {
                console.error('Error loading site data:', error);
                siteData = { products: [], categories: [] };
            }
        }

        // تحميل تفاصيل المنتج
        async function loadProductDetails() {
            try {
                // الحصول على معرف المنتج من URL
                const urlParams = new URLSearchParams(window.location.search);
                const productId = urlParams.get('id');
                
                if (!productId || !siteData) {
                    showProductNotFound();
                    return;
                }
                
                // البحث عن المنتج
                const product = siteData.products?.find(p => p.id === productId);
                if (!product) {
                    showProductNotFound();
                    return;
                }
                
                currentProduct = product;
                
                // عرض تفاصيل المنتج
                displayProductDetails();
                
                // تحميل السيارات المشابهة
                loadRelatedProducts();
                
            } catch (error) {
                console.error('Error loading product details:', error);
                showProductNotFound();
            }
        }

        // عرض تفاصيل المنتج
        function displayProductDetails() {
            if (!currentProduct) return;
            
            // البحث عن القسم
            const category = siteData.categories?.find(c => c.id === currentProduct.categoryId);
            
            // تحديد نوع النص
            const typeText = currentProduct.type === 'new' ? 'جديد' : 
                           currentProduct.type === 'used' ? 'مستعمل' : 'كهربائي';
            
            // بناء HTML
            const html = `
                <div class="product-content">
                    <!-- Product Gallery -->
                    <div class="product-gallery">
                        <img id="mainImage" src="${currentProduct.images?.[0] || 'https://via.placeholder.com/600x400?text=No+Image'}" 
                             alt="${currentProduct.name?.ar || currentProduct.name}" 
                             class="main-image">
                        <div class="thumbnail-slider" id="thumbnailSlider">
                            ${(currentProduct.images || []).map((img, index) => `
                                <img src="${img}" 
                                     alt="صورة ${index + 1}" 
                                     class="thumbnail ${index === 0 ? 'active' : ''}"
                                     onclick="changeMainImage('${img}', this)">
                            `).join('')}
                        </div>
                    </div>

                    <!-- Product Info -->
                    <div class="product-info">
                        <h1 class="product-title">${currentProduct.name?.ar || currentProduct.name || 'منتج'}</h1>
                        <div class="product-category">
                            ${typeText} - ${category?.name?.ar || category?.name || 'غير محدد'}
                        </div>
                        
                        <div class="product-price-section">
                            ${currentProduct.oldPrice ? `
                                <div style="margin-bottom: 0.5rem;">
                                    <span class="old-price">${currentProduct.oldPrice} ${siteData?.site?.currencySymbol || 'ج.م'}</span>
                                    <span class="discount">${calculateDiscount(currentProduct.price, currentProduct.oldPrice)}% خصم</span>
                                </div>
                            ` : ''}
                            <div class="current-price">${currentProduct.price || '0'} ${siteData?.site?.currencySymbol || 'ج.م'}</div>
                        </div>
                        
                        ${currentProduct.installmentPlans?.length > 0 ? `
                        <!-- Installment Section -->
                        <div class="installment-section">
                            <div class="installment-title">
                                <i class="fas fa-credit-card"></i>
                                خيارات التقسيط
                            </div>
                            <div class="installment-options" id="installmentOptions">
                                ${currentProduct.installmentPlans.map((plan, index) => `
                                    <div class="installment-option ${index === 0 ? 'selected' : ''}" 
                                         onclick="selectInstallment(${plan.months}, ${plan.downPayment}, ${plan.monthlyPayment}, this)">
                                        <div class="installment-months">${plan.months} شهر</div>
                                        <div class="installment-down">مقدم: ${plan.downPayment} ${siteData?.site?.currencySymbol || 'ج.م'}</div>
                                        <div class="installment-monthly">${plan.monthlyPayment} ${siteData?.site?.currencySymbol || 'ج.م'}/شهر</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- Product Actions -->
                        <div class="product-actions">
                            <button class="buy-button" onclick="buyProduct()">
                                <i class="fas fa-shopping-cart"></i>
                                شراء الآن
                            </button>
                            <button class="contact-button" onclick="contactAboutProduct()">
                                <i class="fas fa-phone"></i>
                                استفسر عن المنتج
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Product Details Tabs -->
                <div class="product-tabs">
                    <div class="tabs-header">
                        <button class="tab-button active" onclick="showTab('specs')">المواصفات</button>
                        <button class="tab-button" onclick="showTab('features')">المميزات</button>
                        <button class="tab-button" onclick="showTab('description')">الوصف</button>
                    </div>
                    
                    <div id="specsTab" class="tab-content active">
                        <div class="specs-grid">
                            ${(currentProduct.specs || []).map(spec => `
                                <div class="spec-item">
                                    <span class="spec-label">${spec.name || 'مواصفة'}:</span>
                                    <span class="spec-value">${spec.value || 'غير محدد'}</span>
                                </div>
                            `).join('')}
                            
                            ${currentProduct.year ? `
                                <div class="spec-item">
                                    <span class="spec-label">سنة الصنع:</span>
                                    <span class="spec-value">${currentProduct.year}</span>
                                </div>
                            ` : ''}
                            
                            ${currentProduct.color ? `
                                <div class="spec-item">
                                    <span class="spec-label">اللون:</span>
                                    <span class="spec-value">${currentProduct.color}</span>
                                </div>
                            ` : ''}
                            
                            ${currentProduct.engine ? `
                                <div class="spec-item">
                                    <span class="spec-label">المحرك:</span>
                                    <span class="spec-value">${currentProduct.engine}</span>
                                </div>
                            ` : ''}
                            
                            ${currentProduct.transmission ? `
                                <div class="spec-item">
                                    <span class="spec-label">ناقل الحركة:</span>
                                    <span class="spec-value">${currentProduct.transmission}</span>
                                </div>
                            ` : ''}
                            
                            ${currentProduct.fuel ? `
                                <div class="spec-item">
                                    <span class="spec-label">نوع الوقود:</span>
                                    <span class="spec-value">${currentProduct.fuel}</span>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div id="featuresTab" class="tab-content">
                        <div class="features-grid">
                            ${(currentProduct.features || []).map(feature => `
                                <div class="feature-item">
                                    <i class="fas fa-check feature-icon"></i>
                                    <span>${feature}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div id="descriptionTab" class="tab-content">
                        <p style="font-size: 1.1rem; line-height: 1.8; color: var(--dark-gray);">
                            ${currentProduct.description?.ar || currentProduct.description || 'لا يوجد وصف متاح لهذا المنتج.'}
                        </p>
                    </div>
                </div>
            `;
            
            document.getElementById('productContent').innerHTML = html;
            
            // تحديث عنوان المتصفح
            document.title = `${currentProduct.name?.ar || currentProduct.name} | عبدالله للسيارات`;
            
            // تحديث breadcrumb
            document.getElementById('productBreadcrumb').textContent = currentProduct.name?.ar || currentProduct.name;
            
            // تحديد أول خطة تقسيط
            if (currentProduct.installmentPlans?.length > 0) {
                const firstPlan = currentProduct.installmentPlans[0];
                selectedInstallment = {
                    months: firstPlan.months,
                    downPayment: firstPlan.downPayment,
                    monthlyPayment: firstPlan.monthlyPayment
                };
            }
        }

        // حساب نسبة الخصم
        function calculateDiscount(price, oldPrice) {
            if (!oldPrice || !price) return 0;
            const discount = ((oldPrice - price) / oldPrice) * 100;
            return Math.round(discount);
        }

        // تغيير الصورة الرئيسية
        function changeMainImage(imgSrc, element) {
            // تحديث الصورة الرئيسية
            document.getElementById('mainImage').src = imgSrc;
            
            // تحديث الصور المصغرة النشطة
            document.querySelectorAll('.thumbnail').forEach(thumb => {
                thumb.classList.remove('active');
            });
            
            // إضافة النشط للصورة المحددة
            element.classList.add('active');
        }

        // اختيار خطة التقسيط
        function selectInstallment(months, downPayment, monthlyPayment, element) {
            // إزالة التحديد من جميع الخطط
            document.querySelectorAll('.installment-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // إضافة التحديد للخطة المختارة
            element.classList.add('selected');
            
            // حفظ الخطة المختارة
            selectedInstallment = {
                months: months,
                downPayment: downPayment,
                monthlyPayment: monthlyPayment
            };
        }

        // شراء المنتج
        function buyProduct() {
            if (!currentProduct) return;
            
            // إضافة معلومات التقسيط إذا تم اختيارها
            let orderData = {
                productId: currentProduct.id,
                productName: currentProduct.name?.ar || currentProduct.name,
                price: currentProduct.price
            };
            
            if (selectedInstallment) {
                orderData.installment = selectedInstallment;
            }
            
            // حفظ بيانات الطلب في localStorage
            localStorage.setItem('pendingOrder', JSON.stringify(orderData));
            
            // الانتقال لصفحة الطلب
            window.location.href = 'order.html?product=' + currentProduct.id;
        }

        // الاتصال حول المنتج
        function contactAboutProduct() {
            if (!currentProduct) return;
            
            // إنشاء رسالة استفسار
            const message = `أرغب في الاستفسار عن المنتج: ${currentProduct.name?.ar || currentProduct.name}`;
            
            // حفظ الرسالة في localStorage
            localStorage.setItem('productInquiry', JSON.stringify({
                productId: currentProduct.id,
                productName: currentProduct.name?.ar || currentProduct.name,
                message: message,
                timestamp: new Date().toISOString()
            }));
            
            // عرض رسالة
            showToast('تم حفظ استفسارك. سيتم التواصل معك قريباً.');
        }

        // تحميل السيارات المشابهة
        function loadRelatedProducts() {
            if (!currentProduct || !siteData) return;
            
            const container = document.getElementById('relatedProductsGrid');
            const section = document.getElementById('relatedProductsSection');
            
            if (!container) return;
            
            // تصفية السيارات المشابهة (نفس القسم أو النوع)
            const relatedProducts = siteData.products?.filter(product => 
                product.id !== currentProduct.id && 
                (product.categoryId === currentProduct.categoryId || product.type === currentProduct.type)
            ).slice(0, 4) || [];
            
            if (relatedProducts.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            // إظهار القسم
            section.style.display = 'block';
            
            // بناء HTML للسيارات المشابهة
            container.innerHTML = relatedProducts.map(product => {
                const typeText = product.type === 'new' ? 'جديد' : 
                               product.type === 'used' ? 'مستعمل' : 'كهربائي';
                
                return `
                <div class="related-card">
                    <img src="${product.images?.[0] || 'https://via.placeholder.com/400x250?text=No+Image'}" 
                         alt="${product.name?.ar || product.name}" 
                         class="related-image">
                    <div class="related-info">
                        <h3 class="related-name">${product.name?.ar || product.name}</h3>
                        <div class="related-price">${product.price || '0'} ${siteData?.site?.currencySymbol || 'ج.م'}</div>
                        <div style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--dark-gray);">${typeText}</div>
                        <a href="product-details.html?id=${product.id}" class="related-button">
                            عرض التفاصيل
                        </a>
                    </div>
                </div>
                `;
            }).join('');
        }

        // تبديل التبويبات
        function showTab(tabName) {
            // إخفاء جميع المحتويات
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // إزالة النشط من جميع الأزرار
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // إظهار المحتوى المطلوب
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // إضافة النشط للزر المحدد
            event.target.classList.add('active');
        }

        // عرض رسالة عدم وجود المنتج
        function showProductNotFound() {
            const html = `
                <div style="text-align: center; padding: 6rem 2rem;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 4rem; color: var(--primary); margin-bottom: 2rem;"></i>
                    <h2 style="color: var(--secondary); margin-bottom: 1rem;">المنتج غير موجود</h2>
                    <p style="color: var(--dark-gray); margin-bottom: 2rem; font-size: 1.1rem;">
                        المنتج الذي تبحث عنه غير موجود أو تم إزالته.
                    </p>
                    <a href="index.html" style="display: inline-block; padding: 1rem 2rem; background: var(--primary); color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">
                        <i class="fas fa-home"></i>
                        العودة للرئيسية
                    </a>
                </div>
            `;
            document.getElementById('productContent').innerHTML = html;
        }

        // عرض الإشعار
        function showToast(message) {
            const toast = document.getElementById('toast');
            if (!toast) return;
            
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>