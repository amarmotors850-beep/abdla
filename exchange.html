<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø³ÙŠØ§Ø±ØªÙƒ | Ø³ÙŠØ§Ø±Ø§Øª Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡</title>
    
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Animated Background -->
    <style>
        /* ============ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø© ============ */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            overflow: hidden;
            pointer-events: none;
        }

        .floating-particles {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .particle {
            position: absolute;
            background: linear-gradient(45deg, rgba(197, 48, 48, 0.12), rgba(102, 126, 234, 0.12));
            border-radius: 50%;
            filter: blur(60px);
            animation: float-particle 25s infinite;
        }

        .particle:nth-child(1) { width: 500px; height: 500px; top: -150px; right: -150px; animation-delay: 0s; }
        .particle:nth-child(2) { width: 450px; height: 450px; bottom: -150px; left: -150px; animation-delay: -5s; }
        .particle:nth-child(3) { width: 400px; height: 400px; top: 50%; left: 50%; transform: translate(-50%, -50%); animation-delay: -10s; }
        .particle:nth-child(4) { width: 350px; height: 350px; top: 20%; right: 20%; animation-delay: -15s; }
        .particle:nth-child(5) { width: 300px; height: 300px; bottom: 30%; left: 10%; animation-delay: -20s; }
        .particle:nth-child(6) { width: 250px; height: 250px; top: 70%; right: 30%; animation-delay: -25s; }
        .particle:nth-child(7) { width: 200px; height: 200px; bottom: 40%; left: 40%; animation-delay: -30s; }
        .particle:nth-child(8) { width: 150px; height: 150px; top: 30%; left: 20%; animation-delay: -35s; }

        @keyframes float-particle {
            0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.4; }
            25% { transform: translate(3%, 5%) scale(1.15); opacity: 0.55; }
            50% { transform: translate(-2%, 2%) scale(0.9); opacity: 0.35; }
            75% { transform: translate(5%, -3%) scale(1.1); opacity: 0.5; }
        }

        .wave-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 200px;
            overflow: hidden;
        }

        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 100%;
            background: linear-gradient(45deg, 
                rgba(197, 48, 48, 0.07) 0%, 
                rgba(102, 126, 234, 0.07) 25%,
                rgba(197, 48, 48, 0.07) 50%,
                rgba(102, 126, 234, 0.07) 75%,
                rgba(197, 48, 48, 0.07) 100%);
            animation: wave-animation 15s infinite linear;
        }

        .wave::before, .wave::after {
            content: '';
            position: absolute;
            width: 200%;
            height: 100%;
            top: 0;
            left: 0;
            background: inherit;
            animation: wave-animation 20s infinite linear;
            opacity: 0.6;
        }

        .wave::after {
            animation: wave-animation 25s infinite reverse;
            opacity: 0.4;
        }

        @keyframes wave-animation {
            0% { transform: translateX(0) translateY(0) scaleY(1); }
            25% { transform: translateX(-25%) translateY(-10px) scaleY(1.1); }
            50% { transform: translateX(-50%) translateY(-15px) scaleY(1.2); }
            75% { transform: translateX(-75%) translateY(-10px) scaleY(1.1); }
            100% { transform: translateX(-100%) translateY(0) scaleY(1); }
        }

        .gradient-flow {
            position: absolute;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            background: radial-gradient(circle at 50% 50%,
                        rgba(197, 48, 48, 0.08) 0%,
                        rgba(102, 126, 234, 0.08) 20%,
                        rgba(197, 48, 48, 0.06) 40%,
                        rgba(102, 126, 234, 0.06) 60%,
                        transparent 80%);
            animation: rotate-gradient 50s linear infinite;
        }

        @keyframes rotate-gradient {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.3); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .small-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: rgba(197, 48, 48, 0.2);
            border-radius: 50%;
            filter: blur(3px);
            animation: float-small 20s infinite;
        }

        @keyframes float-small {
            0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.25; }
            25% { transform: translate(25px, -35px) scale(1.6); opacity: 0.4; }
            50% { transform: translate(-25px, 25px) scale(0.7); opacity: 0.15; }
            75% { transform: translate(35px, 20px) scale(1.3); opacity: 0.3; }
        }

        @media (max-width: 768px) {
            .particle:nth-child(1), .particle:nth-child(2) { width: 300px; height: 300px; }
            .particle:nth-child(3), .particle:nth-child(4) { width: 250px; height: 250px; }
            .particle:nth-child(5), .particle:nth-child(6) { width: 200px; height: 200px; }
            .particle:nth-child(7), .particle:nth-child(8) { width: 150px; height: 150px; }
        }
    </style>

    <style>
        /* ============ Ù…ØªØºÙŠØ±Ø§Øª CSS ============ */
        :root {
            --primary: #c53030;
            --primary-dark: #9b2c2c;
            --secondary: #0a0a0a;
            --light: #f7fafc;
            --white: #ffffff;
            --gray-100: #f7fafc;
            --gray-200: #edf2f7;
            --gray-300: #e2e8f0;
            --gray-400: #cbd5e0;
            --gray-500: #a0aec0;
            --gray-600: #718096;
            --gray-700: #4a5568;
            --gray-800: #2d3748;
            --gray-900: #1a202c;
            --success: #38a169;
            --warning: #d69e2e;
            --danger: #e53e3e;
            
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.15);
            --shadow-xl: 0 20px 40px rgba(0,0,0,0.2);
            --shadow-2xl: 0 25px 50px -12px rgba(0,0,0,0.25);
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 30px;
            --radius-2xl: 40px;
            --radius-full: 50px;
            
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: var(--light);
            color: var(--gray-900);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* ============ Ø§Ù„Ù‡ÙŠØ¯Ø± (Ù†ÙØ³ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©) ============ */
        .main-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            z-index: 1000;
            box-shadow: var(--shadow-md);
            border-bottom: 1px solid rgba(226, 232, 240, 0.5);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            text-decoration: none;
        }

        .logo-circle {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #c53030, #9b2c2c);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
        }

        .logo-circle i {
            font-size: 2rem;
            color: white;
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-title {
            font-size: 1.8rem;
            font-weight: 900;
            background: linear-gradient(135deg, #c53030, #9b2c2c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.2;
        }

        .logo-subtitle {
            font-size: 0.9rem;
            color: var(--gray-600);
            font-weight: 600;
        }

        .main-nav ul {
            display: flex;
            gap: 1.5rem;
            list-style: none;
        }

        .main-nav a {
            text-decoration: none;
            color: var(--gray-700);
            font-weight: 600;
            padding: 0.8rem 1.2rem;
            border-radius: var(--radius-full);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .main-nav a:hover,
        .main-nav a.active {
            color: var(--primary);
            background: rgba(197, 48, 48, 0.1);
        }

        .nav-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .nav-btn {
            padding: 0.8rem 1.8rem;
            border: none;
            border-radius: var(--radius-full);
            font-family: 'Cairo', sans-serif;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition-bounce);
            display: flex;
            align-items: center;
            gap: 0.7rem;
            text-decoration: none;
        }

        .nav-btn.primary {
            background: linear-gradient(135deg, #c53030, #9b2c2c);
            color: white;
            box-shadow: var(--shadow);
        }

        .nav-btn.primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .nav-btn.secondary {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .nav-btn.secondary:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
        }

        .mobile-menu {
            display: none;
            background: none;
            border: none;
            font-size: 1.8rem;
            color: var(--gray-700);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius-md);
            transition: var(--transition);
        }

        .mobile-menu:hover {
            background: var(--gray-100);
        }

        /* ============ Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© ============ */
        .page-header {
            background: linear-gradient(135deg, #c53030, #9b2c2c);
            color: white;
            padding: 8rem 2rem 4rem;
            margin-bottom: 3rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="rgba(255,255,255,0.1)" fill-opacity="1" d="M0,192L48,197.3C96,203,192,213,288,208C384,203,480,181,576,181.3C672,181,768,203,864,224C960,245,1056,267,1152,250.7C1248,235,1344,181,1392,154.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
            background-size: cover;
            background-position: bottom;
            bottom: 0;
            opacity: 0.2;
        }

        .page-title {
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .page-subtitle {
            font-size: 1.2rem;
            opacity: 0.95;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* ============ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ============ */
        .main-content {
            max-width: 1200px;
            margin: 0 auto 4rem;
            padding: 0 2rem;
        }

        /* ============ Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ============ */
        .steps-container {
            margin-bottom: 3rem;
        }

        .steps-grid {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-bottom: 2rem;
        }

        .steps-grid::before {
            content: '';
            position: absolute;
            top: 40px;
            left: 10%;
            right: 10%;
            height: 3px;
            background: var(--gray-200);
            z-index: 1;
        }

        .step-item {
            position: relative;
            z-index: 2;
            text-align: center;
            flex: 1;
        }

        .step-number {
            width: 80px;
            height: 80px;
            background: white;
            border: 3px solid var(--gray-200);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 900;
            color: var(--gray-500);
            margin: 0 auto 1rem;
            transition: var(--transition);
        }

        .step-item.active .step-number {
            border-color: var(--primary);
            background: linear-gradient(135deg, #c53030, #9b2c2c);
            color: white;
        }

        .step-item.completed .step-number {
            border-color: var(--success);
            background: var(--success);
            color: white;
        }

        .step-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 0.3rem;
        }

        .step-desc {
            color: var(--gray-500);
            font-size: 0.85rem;
        }

        /* ============ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© ============ */
        .car-selection-card {
            background: white;
            border-radius: var(--radius-2xl);
            padding: 2rem;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--gray-200);
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .section-title i {
            color: var(--primary);
        }

        .cars-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .car-card {
            background: var(--gray-100);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-xl);
            padding: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .car-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .car-card.selected {
            border-color: var(--primary);
            background: rgba(197, 48, 48, 0.05);
        }

        .car-image {
            width: 100%;
            height: 180px;
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .car-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .car-name {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .car-price {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .car-specs {
            list-style: none;
            margin-top: 0.8rem;
        }

        .car-specs li {
            color: var(--gray-600);
            font-size: 0.9rem;
            margin-bottom: 0.3rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .car-specs i {
            color: var(--primary);
            width: 20px;
        }

        /* ============ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ============ */
        .form-section {
            background: white;
            border-radius: var(--radius-2xl);
            padding: 2rem;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--gray-200);
            margin-bottom: 2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.6rem;
            color: var(--gray-700);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .form-label.required::after {
            content: ' *';
            color: var(--danger);
        }

        .form-control {
            width: 100%;
            padding: 0.9rem 1.2rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            font-family: 'Cairo', sans-serif;
            font-size: 1rem;
            transition: var(--transition);
            background: var(--gray-100);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(197,48,48,0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%234a5568' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: left 1rem center;
            background-size: 1rem;
            padding-left: 2.5rem;
        }

        /* ============ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± ============ */
        .upload-section {
            border: 2px dashed var(--gray-300);
            border-radius: var(--radius-lg);
            padding: 2rem;
            text-align: center;
            background: var(--gray-100);
            transition: var(--transition);
            cursor: pointer;
        }

        .upload-section:hover {
            border-color: var(--primary);
            background: rgba(197,48,48,0.05);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--gray-500);
            margin-bottom: 1rem;
            transition: var(--transition);
        }

        .upload-section:hover .upload-icon {
            color: var(--primary);
        }

        .upload-text h4 {
            font-size: 1.2rem;
            color: var(--gray-800);
            margin-bottom: 0.5rem;
        }

        .upload-text p {
            color: var(--gray-600);
            margin-bottom: 0.5rem;
        }

        .image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .preview-item {
            position: relative;
            border-radius: var(--radius-lg);
            overflow: hidden;
            height: 120px;
            border: 2px solid var(--gray-200);
        }

        .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-image {
            position: absolute;
            top: 5px;
            left: 5px;
            width: 30px;
            height: 30px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .remove-image:hover {
            background: #c53030;
            transform: scale(1.1);
        }

        /* ============ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ============ */
        .calculator-card {
            background: linear-gradient(135deg, #c53030, #9b2c2c);
            border-radius: var(--radius-2xl);
            padding: 2.5rem;
            color: white;
            margin-bottom: 2rem;
        }

        .calculator-title {
            font-size: 1.8rem;
            font-weight: 800;
            margin-bottom: 2rem;
            text-align: center;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .calculator-item {
            text-align: center;
        }

        .calculator-label {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .calculator-value {
            font-size: 2rem;
            font-weight: 900;
        }

        .calculator-result {
            text-align: center;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-xl);
            margin-top: 1rem;
        }

        .result-label {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        .result-value {
            font-size: 3rem;
            font-weight: 900;
        }

        /* ============ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØ§ØµÙ„ ============ */
        .contact-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .method-card {
            background: var(--gray-100);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 1.5rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .method-card:hover,
        .method-card.selected {
            border-color: var(--primary);
            background: rgba(197,48,48,0.05);
        }

        .method-icon {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.8rem;
        }

        .method-name {
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.3rem;
        }

        /* ============ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ ============ */
        .form-navigation {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--gray-200);
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: var(--radius-lg);
            font-family: 'Cairo', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition-bounce);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #c53030, #9b2c2c);
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--gray-700);
            border: 2px solid var(--gray-300);
        }

        .btn-secondary:hover {
            background: var(--gray-100);
        }

        .btn-success {
            background: linear-gradient(135deg, #38a169, #2f855a);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* ============ Toast ============ */
        .toast-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .toast {
            background: white;
            padding: 1.2rem 1.8rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 1.2rem;
            min-width: 350px;
            max-width: 450px;
            animation: slideInRight 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border-right: 5px solid var(--primary);
        }

        @keyframes slideInRight {
            from { transform: translateX(120%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.success { border-color: var(--success); }
        .toast.error { border-color: var(--danger); }
        .toast.warning { border-color: var(--warning); }

        .toast-icon { font-size: 1.6rem; }
        .toast.success .toast-icon { color: var(--success); }
        .toast.error .toast-icon { color: var(--danger); }
        .toast.warning .toast-icon { color: var(--warning); }

        .toast-content { flex: 1; }
        .toast-title { font-weight: 700; margin-bottom: 0.3rem; color: var(--gray-900); }
        .toast-message { color: var(--gray-600); font-size: 0.95rem; }
        .toast-close { background: none; border: none; color: var(--gray-400); cursor: pointer; padding: 0.6rem; font-size: 1.1rem; transition: var(--transition); }
        .toast-close:hover { color: var(--gray-700); }

        /* ============ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ============ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            z-index: 4000;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .loading-overlay.active { display: flex; }
        .loading-spinner {
            width: 70px;
            height: 70px;
            border: 5px solid var(--gray-200);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1.5rem;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ============ Responsive ============ */
        @media (max-width: 992px) {
            .main-nav ul {
                position: fixed;
                top: 90px;
                right: 0;
                width: 100%;
                background: white;
                flex-direction: column;
                padding: 2rem;
                box-shadow: var(--shadow-xl);
                transform: translateY(-20px);
                opacity: 0;
                visibility: hidden;
                transition: var(--transition);
                z-index: 999;
            }
            .main-nav ul.active {
                transform: translateY(0);
                opacity: 1;
                visibility: visible;
            }
            .mobile-menu { display: block; }
            .steps-grid::before { display: none; }
            .steps-grid { flex-direction: column; gap: 1rem; }
            .step-item { display: flex; align-items: center; gap: 1rem; text-align: right; }
            .step-number { margin: 0; width: 60px; height: 60px; font-size: 1.5rem; }
        }

        @media (max-width: 768px) {
            .nav-container { padding: 0.8rem 1.5rem; }
            .page-header { padding: 7rem 1.5rem 3rem; }
            .page-title { font-size: 2rem; }
            .main-content { padding: 0 1.5rem; }
            .car-selection-card { padding: 1.5rem; }
            .form-section { padding: 1.5rem; }
            .calculator-card { padding: 1.5rem; }
            .calculator-value { font-size: 1.5rem; }
            .result-value { font-size: 2rem; }
            .form-navigation { flex-direction: column; }
            .btn { width: 100%; }
        }

        @media (max-width: 480px) {
            .logo-title { font-size: 1.5rem; }
            .logo-circle { width: 50px; height: 50px; }
            .page-title { font-size: 1.8rem; }
            .section-title { font-size: 1.3rem; }
            .cars-grid { grid-template-columns: 1fr; }
            .calculator-title { font-size: 1.5rem; }
            .contact-methods { grid-template-columns: 1fr; }
        }
    </style>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Supabase Client -->
    <script src="supabase-client.js"></script>
</head>
<body>
    <!-- Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© -->
    <div class="animated-bg">
        <div class="floating-particles">
            <div class="particle"></div><div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div><div class="particle"></div>
            <div class="particle"></div><div class="particle"></div>
        </div>
        <div class="wave-container"><div class="wave"></div></div>
        <div class="gradient-flow"></div>
    </div>

    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <header class="main-header">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <div class="logo-circle">
                    <i class="fas fa-car"></i>
                </div>
                <div class="logo-text">
                    <div class="logo-title">Ø³ÙŠØ§Ø±Ø§Øª Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡</div>
                    <div class="logo-subtitle">Ø±ÙŠØ§Ø¯Ø© ÙˆØ®Ø¨Ø±Ø© Ù…Ù†Ø° 1993</div>
                </div>
            </a>

            <nav class="main-nav">
                <ul id="mainNav">
                    <li><a href="index.html"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                    <li><a href="category.html"><i class="fas fa-car"></i> Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</a></li>
                    <li><a href="sell.html"><i class="fas fa-tag"></i> Ø¨ÙŠØ¹ Ø³ÙŠØ§Ø±ØªÙƒ</a></li>
                    <li><a href="exchange.html" class="active"><i class="fas fa-exchange-alt"></i> Ø§Ø³ØªØ¨Ø¯Ø§Ù„</a></li>
                </ul>
            </nav>

            <div class="nav-actions">
                <a href="sell.html" class="nav-btn primary">
                    <i class="fas fa-plus"></i> Ø¨ÙŠØ¹ Ø³ÙŠØ§Ø±ØªÙƒ
                </a>
            </div>

            <button class="mobile-menu" id="mobileMenu">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
    <div class="page-header">
        <h1 class="page-title">Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø³ÙŠØ§Ø±ØªÙƒ</h1>
        <p class="page-subtitle">Ø§Ø³ØªØ¨Ø¯Ù„ Ø³ÙŠØ§Ø±ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¨Ø³ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙˆØªØ¯ÙØ¹ Ø§Ù„ÙØ±Ù‚ ÙÙ‚Ø·</p>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="main-content">
        <!-- Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ -->
        <div class="steps-container">
            <div class="steps-grid">
                <div class="step-item active" id="step1">
                    <div class="step-number">1</div>
                    <div>
                        <div class="step-title">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</div>
                        <div class="step-desc">Ø§Ø®ØªØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„ØªÙŠ ØªØ±ØºØ¨ Ø¨Ù‡Ø§</div>
                    </div>
                </div>
                <div class="step-item" id="step2">
                    <div class="step-number">2</div>
                    <div>
                        <div class="step-title">Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙŠØ§Ø±ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
                        <div class="step-desc">Ø£Ø¯Ø®Ù„ ØªÙØ§ØµÙŠÙ„ Ø³ÙŠØ§Ø±ØªÙƒ</div>
                    </div>
                </div>
                <div class="step-item" id="step3">
                    <div class="step-number">3</div>
                    <div>
                        <div class="step-title">Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±Ù‚</div>
                        <div class="step-desc">Ø§Ø­Ø³Ø¨ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„</div>
                    </div>
                </div>
                <div class="step-item" id="step4">
                    <div class="step-number">4</div>
                    <div>
                        <div class="step-title">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</div>
                        <div class="step-desc">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ£ÙƒÙ…Ù„</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============ Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ============ -->
        <div id="step1Content" style="display: block;">
            <div class="car-selection-card">
                <h2 class="section-title">
                    <i class="fas fa-car"></i>
                    Ø§Ø®ØªØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                </h2>
                
                <div class="cars-grid" id="newCarsGrid">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--primary);"></i>
                        <p style="margin-top: 1rem; color: var(--gray-600);">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª...</p>
                    </div>
                </div>
                
                <div class="form-navigation">
                    <div></div>
                    <button class="btn btn-primary" id="nextToStep2" disabled>
                        <span>Ø§Ù„ØªØ§Ù„ÙŠ</span>
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- ============ Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ============ -->
        <div id="step2Content" style="display: none;">
            <div class="form-section">
                <h2 class="section-title">
                    <i class="fas fa-car-side"></i>
                    Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙŠØ§Ø±ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                </h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label required">Ø§Ù„Ù…Ø§Ø±ÙƒØ©</label>
                        <input type="text" class="form-control" id="currentBrand" placeholder="Ù…Ø«Ø§Ù„: ØªÙˆÙŠÙˆØªØ§" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</label>
                        <input type="text" class="form-control" id="currentModel" placeholder="Ù…Ø«Ø§Ù„: ÙƒÙˆØ±ÙˆÙ„Ø§" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹</label>
                        <select class="form-control form-select" id="currentYear" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ù†Ø©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„ÙØ¦Ø©</label>
                        <input type="text" class="form-control" id="currentTrim" placeholder="Ù…Ø«Ø§Ù„: SE">
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§Øª</label>
                        <input type="number" class="form-control" id="currentMileage" placeholder="Ø¨Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label>
                        <select class="form-control form-select" id="currentCondition" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø­Ø§Ù„Ø©</option>
                            <option value="excellent">Ù…Ù…ØªØ§Ø²Ø©</option>
                            <option value="very_good">Ø¬ÙŠØ¯Ø© Ø¬Ø¯Ø§Ù‹</option>
                            <option value="good">Ø¬ÙŠØ¯Ø©</option>
                            <option value="fair">Ù…ØªÙˆØ³Ø·Ø©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„ÙˆÙ‚ÙˆØ¯</label>
                        <select class="form-control form-select" id="currentFuel">
                            <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ÙˆÙ‚ÙˆØ¯</option>
                            <option value="Ø¨Ù†Ø²ÙŠÙ†">Ø¨Ù†Ø²ÙŠÙ†</option>
                            <option value="Ø¯ÙŠØ²Ù„">Ø¯ÙŠØ²Ù„</option>
                            <option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¡">ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
                            <option value="Ù‡Ø§ÙŠØ¨Ø±Ø¯">Ù‡Ø§ÙŠØ¨Ø±Ø¯</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ù„ÙˆÙ† Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label>
                        <input type="text" class="form-control" id="currentColor" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø¨ÙŠØ¶">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label required">ÙˆØµÙ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label>
                    <textarea class="form-control form-textarea" id="currentDescription" 
                              placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙØ§Ù‹ ØªÙØµÙŠÙ„ÙŠØ§Ù‹ Ù„Ù„Ø³ÙŠØ§Ø±Ø© (Ø§Ù„Ø¥Ø¶Ø§ÙØ§ØªØŒ Ø§Ù„ØµÙŠØ§Ù†Ø©ØŒ Ø£ÙŠ Ø¹ÙŠÙˆØ¨...)" 
                              required></textarea>
                </div>
                
                <div class="upload-section" onclick="document.getElementById('currentCarImages').click()">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="upload-text">
                        <h4>ØµÙˆØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h4>
                        <p>Ø§Ù†Ù‚Ø± Ù„Ø±ÙØ¹ ØµÙˆØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø© (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 8 ØµÙˆØ±)</p>
                        <p style="color: var(--primary); font-size: 0.85rem;">ÙŠÙÙØ¶Ù„ ØªØµÙˆÙŠØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø²ÙˆØ§ÙŠØ§</p>
                    </div>
                </div>
                
                <input type="file" id="currentCarImages" multiple accept="image/*" style="display: none;" onchange="handleCurrentCarImages(event)">
                
                <div class="image-preview" id="currentImagesPreview"></div>
                
                <div class="form-navigation">
                    <button class="btn btn-secondary" onclick="goToStep(1)">
                        <i class="fas fa-arrow-right"></i>
                        Ø§Ù„Ø³Ø§Ø¨Ù‚
                    </button>
                    <button class="btn btn-primary" onclick="goToStep(3)">
                        <span>Ø§Ù„ØªØ§Ù„ÙŠ</span>
                        <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- ============ Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±Ù‚ ============ -->
        <div id="step3Content" style="display: none;">
            <div class="calculator-card">
                <h2 class="calculator-title">Ø­Ø³Ø§Ø¨ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„</h2>
                
                <div class="calculator-grid">
                    <div class="calculator-item">
                        <div class="calculator-label">Ø³Ø¹Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</div>
                        <div class="calculator-value" id="newCarPrice">0 Ø¬.Ù…</div>
                    </div>
                    <div class="calculator-item">
                        <div class="calculator-label">Ù‚ÙŠÙ…Ø© Ø³ÙŠØ§Ø±ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
                        <div class="calculator-value" id="currentCarValue">0 Ø¬.Ù…</div>
                    </div>
                    <div class="calculator-item">
                        <div class="calculator-label">Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„</div>
                        <div class="calculator-value" id="exchangeFees">5,000 Ø¬.Ù…</div>
                    </div>
                </div>
                
                <div class="calculator-result">
                    <div class="result-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¯ÙØ¹Ù‡</div>
                    <div class="result-value" id="totalAmount">0 Ø¬.Ù…</div>
                </div>
            </div>
            
            <div class="form-navigation">
                <button class="btn btn-secondary" onclick="goToStep(2)">
                    <i class="fas fa-arrow-right"></i>
                    Ø§Ù„Ø³Ø§Ø¨Ù‚
                </button>
                <button class="btn btn-primary" onclick="goToStep(4)">
                    <span>Ø§Ù„ØªØ§Ù„ÙŠ</span>
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
        </div>

        <!-- ============ Ø§Ù„Ø®Ø·ÙˆØ© 4: Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ ============ -->
        <div id="step4Content" style="display: none;">
            <div class="form-section">
                <h2 class="section-title">
                    <i class="fas fa-user"></i>
                    Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©
                </h2>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label required">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                        <input type="text" class="form-control" id="customerName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                        <input type="tel" class="form-control" id="customerPhone" placeholder="01XXXXXXXXX" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" class="form-control" id="customerEmail" placeholder="example@email.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label required">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
                        <input type="text" class="form-control" id="customerCity" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©" required>
                    </div>
                </div>
                
                <h2 class="section-title" style="margin-top: 2rem;">
                    <i class="fas fa-comments"></i>
                    Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…ÙØ¶Ù„Ø©
                </h2>
                
                <div class="contact-methods">
                    <div class="method-card" onclick="selectMethod('whatsapp')">
                        <div class="method-icon"><i class="fab fa-whatsapp"></i></div>
                        <div class="method-name">ÙˆØ§ØªØ³Ø§Ø¨</div>
                        <input type="radio" name="contactMethod" value="whatsapp" style="display: none;">
                    </div>
                    <div class="method-card" onclick="selectMethod('phone')">
                        <div class="method-icon"><i class="fas fa-phone"></i></div>
                        <div class="method-name">Ù…ÙƒØ§Ù„Ù…Ø© Ù‡Ø§ØªÙÙŠØ©</div>
                        <input type="radio" name="contactMethod" value="phone" style="display: none;">
                    </div>
                    <div class="method-card" onclick="selectMethod('email')">
                        <div class="method-icon"><i class="fas fa-envelope"></i></div>
                        <div class="method-name">Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</div>
                        <input type="radio" name="contactMethod" value="email" style="display: none;">
                    </div>
                    <div class="method-card" onclick="selectMethod('visit')">
                        <div class="method-icon"><i class="fas fa-store"></i></div>
                        <div class="method-name">Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…Ø¹Ø±Ø¶</div>
                        <input type="radio" name="contactMethod" value="visit" style="display: none;">
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 2rem;">
                    <label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                    <textarea class="form-control form-textarea" id="additionalNotes" rows="3" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
                </div>
                
                <div class="form-navigation">
                    <button class="btn btn-secondary" onclick="goToStep(3)">
                        <i class="fas fa-arrow-right"></i>
                        Ø§Ù„Ø³Ø§Ø¨Ù‚
                    </button>
                    <button class="btn btn-success" onclick="submitExchangeRequest()">
                        <i class="fas fa-paper-plane"></i>
                        Ø¥ØªÙ…Ø§Ù… Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>

    <script>
        // ============ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… ============
        let siteSettings = null;
        let allProducts = [];
        let currentStep = 1;
        let selectedNewCar = null;
        let currentCarImages = [];
        let selectedMethod = null;

        // ============ Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ============
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸš€ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø³ÙŠØ§Ø±Ø©...');
            
            setupMobileMenu();
            populateYearOptions();
            await loadData();
            await loadNewCars();
            
            console.log('âœ… Ø§Ù„ØµÙØ­Ø© Ø¬Ø§Ù‡Ø²Ø©');
        });

        // ============ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase ============
        async function loadData() {
            try {
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                const settingsResult = await window.db.getSettings();
                if (settingsResult.success) {
                    siteSettings = settingsResult.data;
                }
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                const productsResult = await window.db.getProducts({ active: true, type: 'new' });
                if (productsResult.success) {
                    allProducts = productsResult.data;
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
            }
        }

        // ============ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ============
        async function loadNewCars() {
            const grid = document.getElementById('newCarsGrid');
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase
            let cars = allProducts;
            
            if (cars.length === 0) {
                // Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯
                cars = [
                    {
                        id: 'demo_1',
                        name_ar: 'ØªÙˆÙŠÙˆØªØ§ ÙƒÙˆØ±ÙˆÙ„Ø§ 2024',
                        price: 750000,
                        images: ['https://images.unsplash.com/photo-1544636331-e26879cd4d9b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'],
                        model: 'Corolla',
                        year: 2024,
                        fuel: 'Ø¨Ù†Ø²ÙŠÙ†',
                        engine: '1.8 Ù„ØªØ±'
                    },
                    {
                        id: 'demo_2',
                        name_ar: 'Ù‡ÙŠÙˆÙ†Ø¯Ø§ÙŠ ØªÙˆØ³Ø§Ù† 2024',
                        price: 850000,
                        images: ['https://images.unsplash.com/photo-1544636331-e26879cd4d9b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'],
                        model: 'Tucson',
                        year: 2024,
                        fuel: 'Ø¨Ù†Ø²ÙŠÙ†',
                        engine: '2.0 Ù„ØªØ±'
                    }
                ];
            }
            
            grid.innerHTML = cars.map(car => `
                <div class="car-card" onclick='selectNewCar(${JSON.stringify(car).replace(/'/g, "&#39;")})'>
                    <div class="car-image">
                        <img src="${car.images?.[0] || 'https://images.unsplash.com/photo-1544636331-e26879cd4d9b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'}" 
                             alt="${car.name_ar || car.name}">
                    </div>
                    <h3 class="car-name">${car.name_ar || car.name}</h3>
                    <div class="car-price">${(car.price || 0).toLocaleString()} Ø¬.Ù…</div>
                    <ul class="car-specs">
                        <li><i class="fas fa-calendar-alt"></i> ${car.year || ''}</li>
                        <li><i class="fas fa-gas-pump"></i> ${car.fuel || 'Ø¨Ù†Ø²ÙŠÙ†'}</li>
                        <li><i class="fas fa-engine"></i> ${car.engine || ''}</li>
                    </ul>
                </div>
            `).join('');
        }

        // ============ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ============
        function selectNewCar(car) {
            selectedNewCar = car;
            
            document.querySelectorAll('.car-card').forEach(c => {
                c.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            document.getElementById('nextToStep2').disabled = false;
            document.getElementById('newCarPrice').textContent = `${(car.price || 0).toLocaleString()} Ø¬.Ù…`;
        }

        // ============ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø®Ø·ÙˆØ§Øª ============
        function goToStep(step) {
            if (step === 2 && !selectedNewCar) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø£ÙˆÙ„Ø§Ù‹', 'warning');
                return;
            }
            
            if (step === 3) {
                if (!validateStep2()) return;
                calculateCarValue();
            }
            
            if (step === 4) {
                if (!selectedMethod) {
                    showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØ§ØµÙ„', 'warning');
                    return;
                }
            }
            
            // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
            document.getElementById('step1Content').style.display = 'none';
            document.getElementById('step2Content').style.display = 'none';
            document.getElementById('step3Content').style.display = 'none';
            document.getElementById('step4Content').style.display = 'none';
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
            document.getElementById(`step${step}Content`).style.display = 'block';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø·ÙˆØ§Øª
            document.querySelectorAll('.step-item').forEach((item, index) => {
                item.classList.remove('active', 'completed');
                if (index + 1 < step) {
                    item.classList.add('completed');
                } else if (index + 1 === step) {
                    item.classList.add('active');
                }
            });
            
            currentStep = step;
        }

        // ============ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø®Ø·ÙˆØ© 2 ============
        function validateStep2() {
            const brand = document.getElementById('currentBrand').value;
            const model = document.getElementById('currentModel').value;
            const year = document.getElementById('currentYear').value;
            const mileage = document.getElementById('currentMileage').value;
            const condition = document.getElementById('currentCondition').value;
            const description = document.getElementById('currentDescription').value;
            
            if (!brand || !model || !year || !mileage || !condition || !description) {
                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'warning');
                return false;
            }
            
            if (currentCarImages.length === 0) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ± Ù„Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©', 'warning');
                return false;
            }
            
            return true;
        }

        // ============ Ø­Ø³Ø§Ø¨ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© ============
        function calculateCarValue() {
            const year = parseInt(document.getElementById('currentYear').value);
            const mileage = parseInt(document.getElementById('currentMileage').value);
            const condition = document.getElementById('currentCondition').value;
            
            // Ø­Ø³Ø§Ø¨ ØªÙ‚Ø±ÙŠØ¨ÙŠ Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©
            const currentYear = new Date().getFullYear();
            const age = currentYear - year;
            
            let value = 200000; // Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            value -= age * 10000;
            value -= Math.floor(mileage / 10000) * 5000;
            
            const conditionFactors = {
                excellent: 1.0,
                very_good: 0.85,
                good: 0.7,
                fair: 0.55
            };
            
            value *= conditionFactors[condition] || 0.7;
            value = Math.max(value, 50000);
            
            const newCarPrice = selectedNewCar?.price || 0;
            const fees = 5000;
            const total = Math.max(newCarPrice - value + fees, 0);
            
            document.getElementById('currentCarValue').textContent = `${Math.round(value).toLocaleString()} Ø¬.Ù…`;
            document.getElementById('totalAmount').textContent = `${Math.round(total).toLocaleString()} Ø¬.Ù…`;
        }

        // ============ ØªØ¹Ø¨Ø¦Ø© Ø³Ù†ÙˆØ§Øª Ø§Ù„ØµÙ†Ø¹ ============
        function populateYearOptions() {
            const yearSelect = document.getElementById('currentYear');
            const currentYear = new Date().getFullYear();
            
            for (let year = currentYear; year >= 1980; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            }
        }

        // ============ Ø±ÙØ¹ ØµÙˆØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ============
        async function handleCurrentCarImages(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;
            
            if (currentCarImages.length + files.length > 8) {
                showToast('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù‡Ùˆ 8 ØµÙˆØ± ÙÙ‚Ø·', 'warning');
                return;
            }
            
            showLoading('Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±...');
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                try {
                    // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Supabase Storage
                    const result = await window.db.uploadImage(file);
                    if (result.success) {
                        currentCarImages.push(result.url);
                    }
                } catch (error) {
                    console.error('ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©:', error);
                }
            }
            
            updateCurrentImagesPreview();
            hideLoading();
        }

        function updateCurrentImagesPreview() {
            const preview = document.getElementById('currentImagesPreview');
            preview.innerHTML = currentCarImages.map((img, index) => `
                <div class="preview-item">
                    <img src="${img}" alt="ØµÙˆØ±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©">
                    <button class="remove-image" onclick="removeCurrentImage(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }

        function removeCurrentImage(index) {
            currentCarImages.splice(index, 1);
            updateCurrentImagesPreview();
        }

        // ============ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØ§ØµÙ„ ============
        function selectMethod(method) {
            selectedMethod = method;
            
            document.querySelectorAll('.method-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            event.currentTarget.classList.add('selected');
            event.currentTarget.querySelector('input[type="radio"]').checked = true;
        }

        // ============ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ============
        async function submitExchangeRequest() {
            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('customerPhone').value;
            const city = document.getElementById('customerCity').value;
            
            if (!name || !phone || !city) {
                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'warning');
                return;
            }
            
            if (!selectedMethod) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØ§ØµÙ„', 'warning');
                return;
            }
            
            showLoading('Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„...');
            
            try {
                const exchangeRequest = {
                    customerName: name,
                    customerPhone: phone,
                    customerEmail: document.getElementById('customerEmail').value || null,
                    customerCity: city,
                    currentCar: `${document.getElementById('currentBrand').value} ${document.getElementById('currentModel').value} ${document.getElementById('currentYear').value}`,
                    desiredCar: `${selectedNewCar.name_ar || selectedNewCar.name}`,
                    currentCarDetails: {
                        brand: document.getElementById('currentBrand').value,
                        model: document.getElementById('currentModel').value,
                        year: parseInt(document.getElementById('currentYear').value),
                        trim: document.getElementById('currentTrim').value,
                        mileage: parseInt(document.getElementById('currentMileage').value),
                        condition: document.getElementById('currentCondition').value,
                        fuel: document.getElementById('currentFuel').value,
                        color: document.getElementById('currentColor').value,
                        description: document.getElementById('currentDescription').value,
                        images: currentCarImages
                    },
                    contactMethod: selectedMethod,
                    notes: document.getElementById('additionalNotes').value || null
                };
                
                // Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Supabase
                const result = await window.db.addExchangeRequest(exchangeRequest);
                
                if (result.success) {
                    showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­! Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'success');
                    
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 3000);
                } else {
                    showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨', 'error');
                }
                
            } catch (error) {
                console.error(error);
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨', 'error');
            } finally {
                hideLoading();
            }
        }

        // ============ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„Ø¬ÙˆØ§Ù„ ============
        function setupMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            const mainNav = document.getElementById('mainNav');
            
            mobileMenu.addEventListener('click', () => {
                mainNav.classList.toggle('active');
                mobileMenu.innerHTML = mainNav.classList.contains('active') 
                    ? '<i class="fas fa-times"></i>' 
                    : '<i class="fas fa-bars"></i>';
            });
            
            document.addEventListener('click', (e) => {
                if (!mobileMenu.contains(e.target) && !mainNav.contains(e.target)) {
                    mainNav.classList.remove('active');
                    mobileMenu.innerHTML = '<i class="fas fa-bars"></i>';
                }
            });
        }

        // ============ Toast ============
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = { success: 'âœ…', error: 'âŒ', warning: 'âš ï¸', info: 'â„¹ï¸' };
            
            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || 'â„¹ï¸'}</div>
                <div class="toast-content">
                    <div class="toast-title">${type === 'success' ? 'Ù†Ø¬Ø§Ø­' : type === 'error' ? 'Ø®Ø·Ø£' : type === 'warning' ? 'ØªØ­Ø°ÙŠØ±' : 'Ù…Ø¹Ù„ÙˆÙ…Ø©'}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">Ã—</button>
            `;
            
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 5000);
        }

        // ============ Loading ============
        function showLoading(message) {
            document.getElementById('loadingText').textContent = message;
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        // ============ Ø¯ÙˆØ§Ù„ Ø¹Ø§Ù…Ø© ============
        window.selectNewCar = selectNewCar;
        window.goToStep = goToStep;
        window.handleCurrentCarImages = handleCurrentCarImages;
        window.removeCurrentImage = removeCurrentImage;
        window.selectMethod = selectMethod;
        window.submitExchangeRequest = submitExchangeRequest;
    </script>
</body>
</html>